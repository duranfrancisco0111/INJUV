<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INJUV - Juventud y Voluntariado</title>
    <link rel="stylesheet" href="typography.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="chatbot/styles_bot.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
   
    <!-- Header -->
    <div id="header-container"></div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Voluntariado
                    <span class="highlight">para Chile</span>
                </h1>
                <p class="hero-subtitle">
                    Conecta con oportunidades de voluntariado en m치s de 140 Comunas de Chile mientras desarrollas habilidades 
                    y contribuyes al desarrollo sostenible. M치s de 10,000 j칩venes ya han participado.
                </p>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number" id="statUsuarios">0</span>
                        <span class="stat-label">Usuarios Registrados</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="statOportunidades">0</span>
                        <span class="stat-label">Oportunidades Subidas</span>
                    </div>
                </div>
            </div>
            <div class="hero-image">
                <img src="Fotos_injuv/IMG_8906.JPG" alt="J칩venes voluntarios de INJUV" class="hero-travel-image">
            </div>
        </div>
    </section>


    <!-- Volunteering Carousel -->
    <section class="volunteering-carousel" id="experiencias-voluntariado">
        <div class="container">
            <h2 class="section-title">Experiencias de Voluntariado</h2>
            <p class="section-subtitle">Descubre las incre칤bles experiencias de nuestros voluntarios alrededor del mundo</p>
            
            <div class="carousel-container">
                <div class="carousel-wrapper">
                    <div class="carousel-track" id="carouselTrack">
                        <div class="carousel-slide active">
                            <div class="slide-image">
                                <img src="Fotos_injuv/54281547351_0aaa628927_b.jpg" alt="Experiencia de voluntariado INJUV">
                                <div class="slide-overlay">
                                    <h3>Experiencias de Voluntariado</h3>
                                    <p>J칩venes chilenos participando en proyectos de desarrollo</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="carousel-slide">
                            <div class="slide-image">
                                <img src="Fotos_injuv/54368589547_757eda7fe6_b.jpg" alt="Experiencia de voluntariado INJUV">
                                <div class="slide-overlay">
                                    <h3>Programas de Voluntariado</h3>
                                    <p>Oportunidades de servicio comunitario e internacional</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="carousel-slide">
                            <div class="slide-image">
                                <img src="Fotos_injuv/54730068199_d866975486_b.jpg" alt="Experiencia de voluntariado INJUV">
                                <div class="slide-overlay">
                                    <h3>Compromiso Juvenil</h3>
                                    <p>J칩venes transformando comunidades a trav칠s del voluntariado</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="carousel-slide">
                            <div class="slide-image">
                                <img src="Fotos_injuv/54751927332_a8c92169f5_b.jpg" alt="Experiencia de voluntariado INJUV">
                                <div class="slide-overlay">
                                    <h3>Participaci칩n Activa</h3>
                                    <p>J칩venes comprometidos con el cambio social y comunitario</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="carousel-slide">
                            <div class="slide-image">
                                <img src="Fotos_injuv/54853109430_9945f5fb9c_b.jpg" alt="Experiencia de voluntariado INJUV">
                                <div class="slide-overlay">
                                    <h3>Desarrollo Comunitario</h3>
                                    <p>Construyendo un futuro mejor para nuestras comunidades</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="carousel-progress-bar">
                    <div class="carousel-progress-fill"></div>
                </div>
                
                <div class="carousel-controls">
                    <button class="carousel-btn prev-btn" id="prevBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="carousel-btn next-btn" id="nextBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="carousel-indicators">
                    <span class="indicator active" data-slide="0"></span>
                    <span class="indicator" data-slide="1"></span>
                    <span class="indicator" data-slide="2"></span>
                    <span class="indicator" data-slide="3"></span>
                    <span class="indicator" data-slide="4"></span>
                </div>
            </div>
        </div>
    </section>

    <!-- News Section -->
    <section class="news-section" id="news">
        <div class="container">
            <div class="section-header">
                <h2>Noticias</h2>
                <a href="noticias/noticias.html" class="view-all">Ver todas las noticias</a>
            </div>
            
            <div class="news-grid" id="news-grid-home">
                <!-- Las noticias se cargar치n din치micamente desde la base de datos -->
            </div>
        </div>
    </section>

    <!-- Academia de voluntariado -->
    <section class="news-section" id="academia-voluntariado">
        <div class="container">
            <div class="section-header">
                <h2>Academia de voluntariado</h2>
                <a href="academia/index.html" class="view-all">Ver todo</a>
            </div>
            
            <div class="news-grid" id="academia-grid-home">
                <!-- Se cargar치n din치micamente desde el backend cuando exista -->
            </div>
        </div>
    </section>

    <!-- Biblioteca / estudios -->
    <section class="news-section" id="biblioteca-estudios">
        <div class="container">
            <div class="section-header">
                <h2>Biblioteca / estudios</h2>
                <a href="biblioteca/index.html" class="view-all">Ver todo</a>
            </div>
            
            <div class="news-grid" id="biblioteca-grid-home">
                <!-- Se cargar치n din치micamente desde el backend cuando exista -->
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="features">
        <div class="container">
            <h2 class="section-title">쯇or qu칠 elegir INJUV?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Apoyo Institucional</h3>
                    <p>Contamos con el respaldo oficial del Instituto Nacional de la Juventud y alianzas estrat칠gicas.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <h3>Red de Apoyo</h3>
                    <p>Accede a una red de apoyo de j칩venes chilenos y mentores en destinos.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3>Desarrollo Sostenible</h3>
                    <p>Contribuye a los Objetivos de Desarrollo Sostenible del gobierno mientras desarrollas habilidades.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How it works -->
    <section class="how-it-works" id="how-it-works">
        <div class="container">
            <h2 class="section-title">쮺칩mo funciona?</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h3>1. Crea tu perfil</h3>
                    <p>Reg칤strate gratis y completa tu perfil con tus habilidades e intereses</p>
                </div>
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h3>2. Encuentra oportunidades</h3>
                    <p>Busca y filtra oportunidades de voluntariado que se adapten a ti</p>
                </div>
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <h3>3. Postula a oportunidades</h3>
                    <p>Env칤a tu postulaci칩n a las iniciativas que te interesen y recibe notificaciones sobre su estado.</p>
                </div>
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3>4. 춰Vive y ayuda!</h3>
                    <p>Disfruta de una experiencia 칰nica mientras contribuyes a una causa</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Popular Organizations -->
    <section class="popular-countries">
        <div class="container">
            <h2 class="section-title">Organizaciones</h2>
            <div class="countries-grid" id="organizacionesContainer">
                <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">
                    <p>Cargando organizaciones...</p>
                </div>
            </div>
            <div class="section-footer">
                <a class="btn-outline btn-organizaciones" href="organizaciones/organizaciones.html">Ver todas las organizaciones</a>
            </div>
        </div>
    </section>

    <!-- Featured opportunities -->
    <section class="featured-opportunities" id="explore">
        <div class="container">
            <h2 class="section-title">Oportunidades destacadas</h2>
            <div class="opportunities-grid" id="featuredOpportunitiesContainer">
                <!-- Las oportunidades se cargar치n din치micamente aqu칤 -->
                <div class="loading-message" style="text-align: center; padding: 2rem; color: #666;">
                    <p>Cargando oportunidades destacadas...</p>
                </div>
            </div>
            <div class="section-footer">
                <a class="btn-outline" href="visualizacion-vd/index.html">Ver todas las oportunidades</a>
            </div>
        </div>
    </section>

    <!-- Testimonials -->
    <section class="testimonials" id="testimonials">
        <div class="container">
            <h2 class="section-title">Lo que dicen nuestros voluntarios(as)</h2>
            <div class="testimonials-grid" id="testimonialsContainer">
                <!-- Las rese침as se cargar치n din치micamente aqu칤 -->
                <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">
                    <p>Cargando rese침as...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta" id="cta-section">
        <div class="container">
            <div class="cta-content">
                <h2>쯃isto para tu pr칩xima experiencia de voluntariado?</h2>
                <p>칔nete a miles de j칩venes que ya est치n cambiando el pais.</p>
                <div class="cta-buttons">
                    <a href="inicio de sesion/login.html" class="btn-primary btn-large">Postular ahora</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-wrapper">
            <!-- Barra superior -->
            <div class="footer-top-bar">
                <div class="footer-bar-blue"></div>
                <div class="footer-bar-red"></div>
            </div>
            
            <div class="footer-content">
                <!-- Columna 1: Logos -->
                <div class="footer-section footer-col1">
                    <div class="footer-logos-container">
                        <!-- Logo Clave칔nica -->
                        <div class="footer-logo-claveunica">
                            <img src="Fotos_injuv/ClaveUnica.png" alt="Clave칔nica" class="footer-logo-img claveunica-logo">
                        </div>
                        
                        <p class="footer-admin-text">Servicio de autenticaci칩n administrado por:</p>
                        
                        <!-- Logo Secretar칤a de Gobierno Digital -->
                        <div class="footer-logo-secretaria">
                            <img src="Fotos_injuv/SecretariaGobiernoDigital.png" alt="Secretar칤a de Gobierno Digital" class="footer-logo-img secretaria-logo">
                        </div>
                        
                        <p class="footer-collab-text">Con la colaboraci칩n de:</p>
                        
                        <!-- Logo Ministerio -->
                        <div class="footer-logo-ministerio-small">
                            <img src="Fotos_injuv/color_MinDesarrolloSocialYFamilia.jpg" alt="Ministerio de Desarrollo Social y Familia" class="footer-logo-img ministerio-small-logo">
                        </div>
                        
                        <p class="footer-trademark">INJUV춽</p>
                    </div>
                </div>
                
                <!-- Columna 2: Secciones -->
                <div class="footer-section footer-col2">
                    <h4>Secciones</h4>
                    <ul>
                        <li><a href="noticias/noticias.html">Noticias</a></li>
                        <li><a href="inicio de sesion/login.html">Postular</a></li>
                        <li><a href="#organizaciones">Instituciones p칰blicas</a></li>
                        <li><a href="#">T칠rminos y condiciones</a></li>
                    </ul>
                </div>
                
                <!-- Columna 3: Ayuda a Ciudadanos -->
                <div class="footer-section footer-col3">
                    <h4>Ayuda a Ciudadanos</h4>
                    <a href="#" class="contact-link" id="faq-link">Preguntas frecuentes</a>
                    <p class="contact-info">Horario: Lu - Vi / 9:00hrs - 18:00hrs</p>
                    <a href="tel:+56226204700" class="contact-phone">+56 2 26204700</a>
                </div>
                
                <!-- Columna 4: Ayuda a Instituciones -->
                <div class="footer-section footer-col4">
                    <h4>Ayuda a Instituciones</h4>
                    <p class="contact-info">Horario: Lu - Vi / 9:00hrs - 18:00hrs</p>
                    <a href="tel:+56226204700" class="contact-phone">+56 2 26204700</a>
                </div>
            </div>
            
            <!-- Barra inferior -->
            <div class="footer-bottom-bar">
                <div class="footer-bar-blue"></div>
                <div class="footer-bar-red"></div>
            </div>
        </div>
    </footer>

    <script>
        // Cargar header y configurar enlaces
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                // Extraer solo el contenido del body (el header)
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
                const headerContent = doc.querySelector('header');
                const styles = doc.querySelector('style');
                const scripts = doc.querySelectorAll('script');
                
                // Insertar estilos si existen
                if (styles) {
                    const styleElement = document.createElement('style');
                    styleElement.textContent = styles.textContent;
                    document.head.appendChild(styleElement);
                }
                
                // Insertar el header
                if (headerContent) {
                    document.getElementById('header-container').innerHTML = headerContent.outerHTML;
                } else {
                    // Fallback: extraer solo el contenido del body
                    const bodyContent = doc.body.innerHTML;
                    document.getElementById('header-container').innerHTML = bodyContent;
                }
                
                // Ejecutar los scripts del header manualmente
                scripts.forEach(oldScript => {
                    const newScript = document.createElement('script');
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.textContent = oldScript.textContent;
                    }
                    document.body.appendChild(newScript);
                });
                
                // Ejecutar la inicializaci칩n del header despu칠s de insertarlo
                // Esperar a que los scripts del header se ejecuten
                setTimeout(() => {
                    // Intentar ejecutar las funciones de autenticaci칩n del header
                    if (typeof window.initHeaderAuth === 'function') {
                        window.initHeaderAuth();
                    }
                    if (typeof window.updateHeaderAuth === 'function') {
                        window.updateHeaderAuth();
                    }
                    
                    // Tambi칠n verificar manualmente el estado de sesi칩n
                    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' || 
                                     sessionStorage.getItem('isLoggedIn') === 'true';
                    const loginLink = document.getElementById('login-link');
                    const userProfileMenu = document.getElementById('userProfileMenu');
                    const profileUserName = document.getElementById('profileUserName');
                    const profileUserEmail = document.getElementById('profileUserEmail');
                    
                    if (isLoggedIn) {
                        // Ocultar bot칩n de login
                        if (loginLink) {
                            loginLink.style.display = 'none';
                            loginLink.style.visibility = 'hidden';
                        }
                        
                        // Mostrar men칰 de perfil
                        if (userProfileMenu) {
                            userProfileMenu.style.display = 'block';
                            userProfileMenu.classList.add('active');
                            
                            // Actualizar informaci칩n del usuario
                            const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
                            const userEmail = localStorage.getItem('userEmail') || sessionStorage.getItem('userEmail');
                            const userNombre = localStorage.getItem('userNombre') || '';
                            const userApellido = localStorage.getItem('userApellido') || '';
                            
                            if (profileUserName) {
                                const nombreCompleto = `${userNombre} ${userApellido}`.trim() || 'Usuario';
                                profileUserName.textContent = nombreCompleto;
                            }
                            if (profileUserEmail) {
                                profileUserEmail.textContent = userEmail || '';
                            }
                        }
                    } else {
                        // Mostrar bot칩n de login
                        if (loginLink) {
                            loginLink.style.display = 'inline-flex';
                            loginLink.style.visibility = 'visible';
                        }
                        
                        // Ocultar men칰 de perfil
                        if (userProfileMenu) {
                            userProfileMenu.style.display = 'none';
                            userProfileMenu.classList.remove('active');
                        }
                        
                        // Mostrar secci칩n CTA si no hay sesi칩n
                        const ctaSection = document.getElementById('cta-section');
                        if (ctaSection) {
                            ctaSection.style.display = 'block';
                        }
                    }
                    
                    // Ocultar secci칩n CTA si hay sesi칩n iniciada
                    if (isLoggedIn) {
                        const ctaSection = document.getElementById('cta-section');
                        if (ctaSection) {
                            ctaSection.style.display = 'none';
                        }
                    }
                }, 300);
                
                // Configurar enlaces del header
                setTimeout(() => {
                    // Logo - va a p치gina principal
                    const logo = document.getElementById('logo-link');
                    if (logo) logo.href = 'index.html';
                    
                    // 쮺칩mo funciona? - scroll a secci칩n
                    const howWorks = document.getElementById('how-it-works-link');
                    if (howWorks) {
                        howWorks.href = '#how-it-works';
                        howWorks.onclick = (e) => {
                            e.preventDefault();
                            document.getElementById('how-it-works').scrollIntoView({ behavior: 'smooth', block: 'start' });
                        };
                    }
                    
                    // Experiencias - scroll a secci칩n
                    const experiencias = document.getElementById('experiencias-link');
                    if (experiencias) {
                        experiencias.href = '#experiencias-voluntariado';
                        experiencias.onclick = (e) => {
                            e.preventDefault();
                            document.getElementById('experiencias-voluntariado').scrollIntoView({ behavior: 'smooth', block: 'start' });
                        };
                    }
                    
                    // Noticias - usar funci칩n del header
                    const noticias = document.getElementById('news-link');
                    if (noticias) {
                        noticias.href = '#news';
                        noticias.onclick = function(e) {
                            if (window.goToNoticias) {
                                window.goToNoticias(e);
                            } else {
                                e.preventDefault();
                                const section = document.getElementById('news');
                                if (section) {
                                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            }
                            return false;
                        };
                    }
                    
                    // Login
                    const login = document.getElementById('login-link');
                    if (login) login.href = 'inicio de sesion/login.html';
                    
                    // Men칰 m칩vil toggle
                    const menuToggle = document.getElementById('menuToggle');
                    const mainNav = document.querySelector('.main-nav');
                    if (menuToggle && mainNav) {
                        menuToggle.addEventListener('click', () => {
                            menuToggle.classList.toggle('active');
                            mainNav.classList.toggle('active');
                            menuToggle.setAttribute('aria-expanded', menuToggle.classList.contains('active'));
                        });
                        
                        // Cerrar men칰 al hacer clic en un enlace
                        const navLinks = mainNav.querySelectorAll('.nav-link');
                        navLinks.forEach(link => {
                            link.addEventListener('click', () => {
                                if (window.innerWidth <= 1024) {
                                    menuToggle.classList.remove('active');
                                    mainNav.classList.remove('active');
                                    menuToggle.setAttribute('aria-expanded', 'false');
                                }
                            });
                        });
                    }
                    
                    // Dropdowns m칩viles
                    const dropdownItems = document.querySelectorAll('.nav-item.dropdown');
                    dropdownItems.forEach(item => {
                        const link = item.querySelector('.nav-link');
                        if (link && window.innerWidth <= 1024) {
                            link.addEventListener('click', (e) => {
                                e.preventDefault();
                                item.classList.toggle('open');
                            });
                        }
                    });
                    
                    // Header scroll effect
                    const header = document.getElementById('header');
                    if (header) {
                        window.addEventListener('scroll', () => {
                            if (window.scrollY > 20) {
                                header.classList.add('scrolled');
                            } else {
                                header.classList.remove('scrolled');
                            }
                        });
                    }
                    
                    // Scroll autom치tico si hay hash en la URL
                    if (window.location.hash) {
                        setTimeout(() => {
                            const target = document.querySelector(window.location.hash);
                            if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 300);
                    }
                }, 100);
            })
            .catch(error => console.error('Error:', error));
    </script>
    <script src="script.js"></script>
    
    <!-- Script para cargar oportunidades destacadas -->
    <script>
        const API_BASE_URL = 'http://127.0.0.1:5000/api';
        
        // Cargar rese침as p칰blicas desde el backend
        async function cargarRese침asPublicas() {
            try {
                const response = await fetch(`${API_BASE_URL}/rese침as/publicas?limite=3`);
                const data = await response.json();
                
                if (data.success && data.rese침as) {
                    mostrarRese침as(data.rese침as);
                } else {
                    mostrarMensajeSinRese침as();
                }
            } catch (error) {
                console.error('Error al cargar rese침as p칰blicas:', error);
                mostrarMensajeSinRese침as();
            }
        }
        
        function mostrarRese침as(rese침as) {
            const container = document.getElementById('testimonialsContainer');
            if (!container) return;
            
            if (rese침as.length === 0) {
                mostrarMensajeSinRese침as();
                return;
            }
            
            container.innerHTML = '';
            
            rese침as.forEach(rese침a => {
                const card = crearCardRese침a(rese침a);
                container.appendChild(card);
            });
        }
        
        function crearCardRese침a(rese침a) {
            const card = document.createElement('div');
            card.className = 'testimonial-card';
            
            // Generar estrellas seg칰n la calificaci칩n (5 estrellas llenas como en la imagen)
            const calificacion = rese침a.calificacion || 5; // Por defecto 5 estrellas
            const estrellasHTML = generarEstrellas(calificacion);
            
            card.innerHTML = `
                <div class="testimonial-content">
                    <div class="stars">
                        ${estrellasHTML}
                    </div>
                    <p>"${rese침a.rese침a || 'Sin comentario'}"</p>
                </div>
                <div class="testimonial-author">
                    <div class="author-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="author-info">
                        <h4>${rese침a.usuario_nombre || 'Usuario'}</h4>
                        <span class="author-organization">${rese침a.organizacion_nombre || 'Organizaci칩n'}</span>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        function generarEstrellas(calificacion) {
            // Seg칰n la imagen, siempre mostrar 5 estrellas amarillas llenas
            let estrellasHTML = '';
            for (let i = 1; i <= 5; i++) {
                estrellasHTML += '<i class="fas fa-star"></i>';
            }
            return estrellasHTML;
        }
        
        function mostrarMensajeSinRese침as() {
            const container = document.getElementById('testimonialsContainer');
            if (container) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">
                        <p>Pr칩ximamente estar치n disponibles las rese침as de nuestros voluntarios.</p>
                    </div>
                `;
            }
        }
        
        // Cargar oportunidades destacadas desde el backend
        async function cargarOportunidadesDestacadas() {
            try {
                const response = await fetch(`${API_BASE_URL}/oportunidades?estado=activa`);
                const data = await response.json();
                
                if (data.success && data.oportunidades) {
                    // Filtrar oportunidades cerradas
                    const oportunidadesActivas = data.oportunidades.filter(op => op.estado !== 'cerrada');
                    // Tomar las primeras 3 oportunidades como destacadas
                    const destacadas = oportunidadesActivas.slice(0, 3);
                    mostrarOportunidadesDestacadas(destacadas);
                } else {
                    mostrarMensajeSinOportunidades();
                }
            } catch (error) {
                console.error('Error al cargar oportunidades destacadas:', error);
                mostrarMensajeError();
            }
        }
        
        function mostrarOportunidadesDestacadas(oportunidades) {
            const container = document.getElementById('featuredOpportunitiesContainer');
            if (!container) return;
            
            if (oportunidades.length === 0) {
                mostrarMensajeSinOportunidades();
                return;
            }
            
            container.innerHTML = '';
            
            oportunidades.forEach(op => {
                const card = crearCardOportunidadDestacada(op);
                container.appendChild(card);
            });
        }
        
        function crearCardOportunidadDestacada(op) {
            const card = document.createElement('div');
            card.className = 'opportunity-card';
            
            // Determinar badge seg칰n el t칤tulo o descripci칩n
            const badge = determinarBadge(op.titulo, op.descripcion);
            
            // Formatear fecha l칤mite
            const fechaLimite = op.fecha_limite_postulacion ? 
                new Date(op.fecha_limite_postulacion).toLocaleDateString('es-CL', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric' 
                }) : 
                'Sin fecha l칤mite';
            
            // Ubicaci칩n - priorizar campos de la oportunidad, usar organizaci칩n como fallback
            let ubicacion = [];
            if (op.comuna_opor) ubicacion.push(op.comuna_opor);
            else if (op.organizacion_comuna) ubicacion.push(op.organizacion_comuna);
            
            if (op.ciudad_opor) ubicacion.push(op.ciudad_opor);
            else if (op.organizacion_ciudad) ubicacion.push(op.organizacion_ciudad);
            
            if (op.region_opor) ubicacion.push(op.region_opor);
            else if (op.organizacion_region) ubicacion.push(op.organizacion_region);
            
            const ubicacionTexto = ubicacion.length > 0 
                ? ubicacion.join(', ') 
                : 'Ubicaci칩n no especificada';
            
            card.innerHTML = `
                <div class="card-content">
                    <div class="theme-badge">${badge}</div>
                    <h3>${op.titulo || 'Oportunidad de voluntariado'}</h3>
                    <p class="description">
                        ${op.descripcion ? (op.descripcion.length > 120 ? op.descripcion.substring(0, 120) + '...' : op.descripcion) : 'Descripci칩n no disponible'}
                    </p>
                    <div class="organizer-badge">
                        <i class="fas fa-home"></i>
                        <span>${op.organizacion_nombre || 'Organizaci칩n'}</span>
                    </div>
                    <div class="card-details">
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${ubicacionTexto}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-calendar"></i>
                            <span>${fechaLimite}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-users"></i>
                            <span>${op.cupo_maximo || 'N/A'} cupos</span>
                        </div>
                    </div>
                    <div class="card-buttons">
                        <button class="btn-postular" onclick="postularDesdeDestacadas(${op.id})">Postular</button>
                        <button class="btn-detalles" onclick="verDetallesDesdeDestacadas(${op.id})">Ver detalles</button>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        function determinarBadge(titulo, descripcion) {
            const texto = (titulo + ' ' + descripcion).toLowerCase();
            
            if (texto.includes('eco') || texto.includes('ambiental') || texto.includes('reforestaci칩n') || texto.includes('verde')) {
                return 'Eco Friendly';
            } else if (texto.includes('educaci칩n') || texto.includes('ense침anza') || texto.includes('tutor칤a') || texto.includes('apoyo escolar')) {
                return 'Educaci칩n';
            } else if (texto.includes('salud') || texto.includes('m칠dico') || texto.includes('hospital')) {
                return 'Salud';
            } else if (texto.includes('comunidad') || texto.includes('social') || texto.includes('ayuda')) {
                return 'Comunidad';
            } else if (texto.includes('deporte') || texto.includes('recreaci칩n') || texto.includes('actividad f칤sica')) {
                return 'Deporte';
            } else {
                return 'Voluntariado';
            }
        }
        
        function mostrarMensajeSinOportunidades() {
            const container = document.getElementById('featuredOpportunitiesContainer');
            if (container) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #666;">
                        <p style="font-size: 1.1rem; margin-bottom: 1rem;">No hay oportunidades destacadas disponibles en este momento.</p>
                        <a href="visualizacion-vd/index.html" class="btn-outline" style="display: inline-block; margin-top: 1rem;">
                            Ver todas las oportunidades
                        </a>
                    </div>
                `;
            }
        }
        
        function mostrarMensajeError() {
            const container = document.getElementById('featuredOpportunitiesContainer');
            if (container) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #666;">
                        <p style="font-size: 1.1rem; margin-bottom: 1rem;">Error al cargar las oportunidades. Por favor, intenta m치s tarde.</p>
                        <a href="visualizacion-vd/index.html" class="btn-outline" style="display: inline-block; margin-top: 1rem;">
                            Ver todas las oportunidades
                        </a>
                    </div>
                `;
            }
        }
        
        // Funciones para los botones
        window.postularDesdeDestacadas = function(oportunidadId) {
            const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
            if (!userId) {
                alert('Debes iniciar sesi칩n para postular a una oportunidad');
                if (typeof window.redirectTo === 'function') {
                    window.redirectTo('inicio de sesion/login.html');
                } else {
                    window.location.href = 'inicio de sesion/login.html';
                }
                return;
            }
            // Redirigir a la p치gina de visualizaci칩n con el ID
            const redirectPath = `visualizacion-vd/index.html?postular=${oportunidadId}`;
            if (typeof window.redirectTo === 'function') {
                window.redirectTo(redirectPath);
            } else {
                window.location.href = redirectPath;
            }
        };
        
        window.verDetallesDesdeDestacadas = function(oportunidadId) {
            // Redirigir a la p치gina de visualizaci칩n
            const redirectPath = `visualizacion-vd/index.html?ver=${oportunidadId}`;
            if (typeof window.redirectTo === 'function') {
                window.redirectTo(redirectPath);
            } else {
                window.location.href = redirectPath;
            }
        };
        
        // Cargar estad칤sticas del hero
        async function cargarEstadisticasHero() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/estadisticas`);
                const data = await response.json();
                
                if (data.success) {
                    const statUsuarios = document.getElementById('statUsuarios');
                    const statOportunidades = document.getElementById('statOportunidades');
                    
                    if (statUsuarios) {
                        animarNumero(statUsuarios, data.usuarios_registrados || 0);
                    }
                    if (statOportunidades) {
                        animarNumero(statOportunidades, data.voluntariados_creados || 0);
                    }
                }
            } catch (error) {
                console.error('Error al cargar estad칤sticas:', error);
            }
        }
        
        function animarNumero(elemento, valorFinal) {
            const duracion = 2000; // 2 segundos
            const incremento = valorFinal / (duracion / 16); // 60 FPS
            let valorActual = 0;
            
            const animacion = setInterval(() => {
                valorActual += incremento;
                if (valorActual >= valorFinal) {
                    elemento.textContent = valorFinal.toLocaleString('es-CL');
                    clearInterval(animacion);
                } else {
                    elemento.textContent = Math.floor(valorActual).toLocaleString('es-CL');
                }
            }, 16);
        }
        
        // Cargar organizaciones
        async function cargarOrganizaciones() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/organizaciones`);
                const data = await response.json();
                
                if (data.success && data.organizaciones) {
                    mostrarOrganizaciones(data.organizaciones.slice(0, 3)); // Mostrar m치ximo 3
                } else {
                    mostrarMensajeSinOrganizaciones();
                }
            } catch (error) {
                console.error('Error al cargar organizaciones:', error);
                mostrarMensajeSinOrganizaciones();
            }
        }
        
        function mostrarOrganizaciones(organizaciones) {
            const container = document.getElementById('organizacionesContainer');
            if (!container) return;
            
            if (organizaciones.length === 0) {
                mostrarMensajeSinOrganizaciones();
                return;
            }
            
            container.innerHTML = '';
            
            organizaciones.forEach(org => {
                const card = document.createElement('div');
                card.className = 'country-card';
                card.style.cursor = 'pointer';
                card.setAttribute('data-org-id', org.id);
                card.innerHTML = `
                    <div class="country-flag">游끽</div>
                    <h3>${org.nombre || 'Organizaci칩n'}</h3>
                    <p>${org.area_trabajo || 'Sin 치rea especificada'}</p>
                    <span class="country-count">${org.num_oportunidades || 0} oportunidades</span>
                `;
                
                // Agregar event listener para redirigir al perfil
                card.addEventListener('click', function() {
                    const orgId = this.getAttribute('data-org-id');
                    if (orgId) {
                        // Determinar la ruta seg칰n la ubicaci칩n actual
                        const currentPath = window.location.pathname;
                        let profileUrl = '';
                        
                        if (currentPath.includes('template/index.html') || 
                            currentPath.endsWith('template/') || 
                            currentPath.endsWith('template')) {
                            // Estamos en template/index.html
                            profileUrl = `Roles/Perfil_organizacion/index.html?organizacion_id=${orgId}`;
                        } else if (currentPath.includes('/template/')) {
                            // Estamos en alguna p치gina dentro de template
                            profileUrl = `Roles/Perfil_organizacion/index.html?organizacion_id=${orgId}`;
                        } else {
                            // Estamos en la ra칤z
                            profileUrl = `template/Roles/Perfil_organizacion/index.html?organizacion_id=${orgId}`;
                        }
                        
                        if (typeof window.redirectTo === 'function') {
                            window.redirectTo(profileUrl);
                        } else {
                            window.location.href = profileUrl;
                        }
                    }
                });
                
                container.appendChild(card);
            });
        }
        
        function mostrarMensajeSinOrganizaciones() {
            const container = document.getElementById('organizacionesContainer');
            if (container) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">
                        <p>No hay organizaciones disponibles en este momento.</p>
                    </div>
                `;
            }
        }
        
        // Cargar noticias desde el backend
        async function cargarNoticiasHome() {
            const newsGrid = document.getElementById('news-grid-home');
            if (!newsGrid) {
                console.error('No se encontr칩 el elemento news-grid-home');
                return;
            }
            
            try {
                console.log('Cargando noticias desde:', `${API_BASE_URL}/noticias?estado=activa`);
                // Cargar todas las noticias (activas e inactivas) para verificar qu칠 hay
                let response = await fetch(`${API_BASE_URL}/noticias?estado=todas`);
                
                // Verificar si la respuesta es OK (status 200-299)
                if (!response.ok) {
                    console.error('Error del servidor:', response.status, response.statusText);
                    mostrarMensajeSinNoticias(newsGrid);
                    return;
                }
                
                // Intentar parsear JSON
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    console.error('Error al parsear JSON:', jsonError);
                    mostrarMensajeSinNoticias(newsGrid);
                    return;
                }
                
                console.log('Respuesta del servidor:', data);
                
                if (data.success && data.noticias && data.noticias.length > 0) {
                    // Filtrar solo las activas para mostrar
                    const noticiasActivas = data.noticias.filter(n => n.estado === 'activa');
                    console.log('Noticias activas encontradas:', noticiasActivas.length);
                    
                    if (noticiasActivas.length > 0) {
                        // Tomar solo las primeras 3 noticias para la p치gina principal
                        const noticiasPrincipales = noticiasActivas.slice(0, 3);
                        console.log('Mostrando noticias reales:', noticiasPrincipales);
                        renderizarNoticiasHome(noticiasPrincipales, newsGrid);
                    } else {
                        console.log('No hay noticias activas disponibles');
                        // Si no hay activas, mostrar mensaje
                        mostrarMensajeSinNoticias(newsGrid);
                    }
                } else {
                    console.log('No hay noticias en la base de datos');
                    // Si no hay noticias, mostrar mensaje
                    mostrarMensajeSinNoticias(newsGrid);
                }
            } catch (error) {
                console.error('Error al cargar noticias (backend probablemente apagado):', error);
                // Si hay un error de red o conexi칩n, mostrar mensaje
                mostrarMensajeSinNoticias(newsGrid);
            }
        }
        
        // Renderizar noticias en la p치gina principal
        function renderizarNoticiasHome(noticias, container) {
            const noticiasHTML = noticias.map((noticia) => {
                // Formatear fecha de manera mejorada
                let fechaFormateada = '';
                let fechaObj = null;
                
                if (noticia.fecha_publicacion) {
                    fechaObj = noticia.fecha_publicacion instanceof Date 
                        ? noticia.fecha_publicacion 
                        : new Date(noticia.fecha_publicacion);
                } else if (noticia.created_at) {
                    fechaObj = new Date(noticia.created_at);
                }
                
                if (fechaObj && !isNaN(fechaObj.getTime())) {
                    const diasSemana = ['dom', 'lun', 'mar', 'mi칠', 'jue', 'vie', 's치b'];
                    const meses = ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'];
                    
                    const diaSemana = diasSemana[fechaObj.getDay()];
                    const dia = fechaObj.getDate();
                    const mes = meses[fechaObj.getMonth()];
                    const horas = fechaObj.getHours().toString().padStart(2, '0');
                    const minutos = fechaObj.getMinutes().toString().padStart(2, '0');
                    const ampm = horas >= 12 ? 'p. m.' : 'a. m.';
                    const horas12 = horas % 12 || 12;
                    
                    fechaFormateada = `${diaSemana}, ${dia} ${mes}, ${horas12}:${minutos} ${ampm}`;
                } else {
                    fechaFormateada = 'Fecha no disponible';
                }
                
                // Mejorar el resumen - limpiar y formatear
                let resumen = noticia.resumen || (noticia.contenido ? noticia.contenido.trim() : '');
                if (resumen && resumen.length > 180) {
                    resumen = resumen.substring(0, 180).trim();
                    // Asegurar que termine en una palabra completa
                    const ultimoEspacio = resumen.lastIndexOf(' ');
                    if (ultimoEspacio > 150) {
                        resumen = resumen.substring(0, ultimoEspacio);
                    }
                    resumen += '...';
                }
                
                // Determinar icono y categor칤as seg칰n el contenido
                const tituloLower = (noticia.titulo || '').toLowerCase();
                const contenidoLower = (resumen || '').toLowerCase();
                const textoCompleto = tituloLower + ' ' + contenidoLower;
                
                let icono = 'fa-newspaper';
                const categorias = [];
                
                if (textoCompleto.includes('voluntariado') || textoCompleto.includes('ayuda') || textoCompleto.includes('colaboraci칩n')) {
                    icono = 'fa-hands-helping';
                    categorias.push('Voluntariado');
                }
                if (textoCompleto.includes('ambiental') || textoCompleto.includes('reforestaci칩n') || textoCompleto.includes('medio ambiente') || textoCompleto.includes('ecolog칤a')) {
                    icono = 'fa-seedling';
                    categorias.push('Medio Ambiente');
                }
                if (textoCompleto.includes('educaci칩n') || textoCompleto.includes('tutor') || textoCompleto.includes('estudiante') || textoCompleto.includes('ense침anza')) {
                    icono = 'fa-graduation-cap';
                    categorias.push('Educaci칩n');
                }
                if (textoCompleto.includes('salud') || textoCompleto.includes('m칠dico') || textoCompleto.includes('hospital')) {
                    icono = 'fa-heart';
                    categorias.push('Salud');
                }
                if (textoCompleto.includes('emergencia') || textoCompleto.includes('desastre') || textoCompleto.includes('ayuda humanitaria')) {
                    icono = 'fa-shield-alt';
                    categorias.push('Emergencia');
                }
                
                // Si no hay categor칤as detectadas, agregar "Noticias"
                if (categorias.length === 0) {
                    categorias.push('Noticias');
                }
                
                // Construir URL de imagen usando directamente lo que viene de la BD
                let imagenURL = '';
                const filename = noticia.imagen_filename || noticia.imagen_url || '';
                if (filename) {
                    imagenURL = `${API_BASE_URL}/noticias/imagen/${filename}`;
                }
                
                const imagenHTML = imagenURL 
                    ? `<img src="${imagenURL}" alt="${noticia.titulo}" class="news-image-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`
                    : '';
                
                const placeholderHTML = `<div class="image-placeholder" ${imagenURL ? 'style="display:none;"' : ''}><i class="fas ${icono}"></i></div>`;
                
                const categoriasHTML = categorias.map(cat => `<span class="category">${cat}</span>`).join('');
                
                // Capitalizar el t칤tulo correctamente
                const titulo = (noticia.titulo || '').charAt(0).toUpperCase() + (noticia.titulo || '').slice(1);
                
                return `
                    <article class="news-card">
                        <div class="news-image">
                            ${imagenHTML}
                            ${placeholderHTML}
                            <div class="news-categories">
                                ${categoriasHTML}
                            </div>
                        </div>
                        <div class="news-content">
                            <h3>${titulo}</h3>
                            ${resumen ? `<p class="news-description">${resumen}</p>` : ''}
                            <div class="news-meta">
                                <span class="news-date">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${fechaFormateada}
                                </span>
                                <a href="#" class="read-more" onclick="verDetalleNoticia(${noticia.id}); return false;">
                                    Ver m치s
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </article>
                `;
            }).join('');
            
            container.innerHTML = noticiasHTML;
        }
        
        // Mostrar mensaje cuando no hay noticias disponibles
        function mostrarMensajeSinNoticias(container) {
            if (!container) return;
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 3rem 1rem; color: #666;">
                    <i class="fas fa-newspaper" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                    <p style="font-size: 1.1rem; margin-bottom: 0.5rem; font-weight: 500;">No hay noticias disponibles</p>
                    <p style="font-size: 0.9rem; opacity: 0.8;">Las noticias se cargar치n cuando el servidor est칠 disponible.</p>
                </div>
            `;
        }

        // Mensaje gen칠rico para secciones nuevas (academia/biblioteca)
        // Mantiene exactamente el mismo tama침o/espaciado que el vac칤o de "Noticias"
        function mostrarMensajeSinContenido(container, titulo = 'Secci칩n en desarrollo') {
            if (!container) return;
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 3rem 1rem; color: #666;">
                    <i class="fas fa-newspaper" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                    <p style="font-size: 1.1rem; margin-bottom: 0.5rem; font-weight: 500;">${titulo}</p>
                    <p style="font-size: 0.9rem; opacity: 0.8;">El contenido se cargar치 cuando el servidor est칠 disponible.</p>
                </div>
            `;
        }

        async function cargarAcademiaHome() {
            const container = document.getElementById('academia-grid-home');
            if (!container) return;
            // No hay endpoint a칰n  mostrar estado vac칤o (sin datos predeterminados)
            mostrarMensajeSinContenido(container, 'Academia de voluntariado');
        }

        async function cargarBibliotecaHome() {
            const container = document.getElementById('biblioteca-grid-home');
            if (!container) return;
            try {
                const response = await fetch(`${API_BASE_URL}/biblioteca/documentos`);
                const data = await response.json();
                if (data.success && data.documentos && data.documentos.length > 0) {
                    const docs = data.documentos.slice(0, 3);
                    container.innerHTML = docs.map(doc => {
                        const desc = (doc.descripcion || '').slice(0, 100) + ((doc.descripcion || '').length > 100 ? '' : '');
                        const tematica = doc.tematica_nombre ? `<span class="category">${doc.tematica_nombre}</span>` : '';
                        return `
                            <article class="news-card">
                                <div class="news-image">
                                    <div class="image-placeholder" style="display:flex;"><i class="fas fa-file-alt"></i></div>
                                    <div class="news-categories">${tematica}</div>
                                </div>
                                <div class="news-content">
                                    <h3>${(doc.nombre_archivo || '').slice(0, 60)}${(doc.nombre_archivo || '').length > 60 ? '' : ''}</h3>
                                    ${desc ? `<p class="news-description">${desc}</p>` : ''}
                                    <div class="news-meta">
                                        <span class="news-date"><i class="fas fa-user"></i> ${doc.autor || ''}</span>
                                        <span class="news-date"><i class="fas fa-calendar-alt"></i> ${doc.fecha_edicion || ''}</span>
                                        <a href="biblioteca/index.html" class="read-more">Ver m치s</a>
                                    </div>
                                </div>
                            </article>
                        `;
                    }).join('');
                } else {
                    mostrarMensajeSinContenido(container, 'Biblioteca / estudios');
                }
            } catch (e) {
                mostrarMensajeSinContenido(container, 'Biblioteca / estudios');
            }
        }
        
        // Cargar usuarios registrados
        // Cargar todo cuando el DOM est칠 listo
        document.addEventListener('DOMContentLoaded', () => {
            cargarOportunidadesDestacadas();
            cargarRese침asPublicas();
            cargarEstadisticasHero();
            cargarOrganizaciones();
            cargarNoticiasHome();
            cargarAcademiaHome();
            cargarBibliotecaHome();
        });
    </script>
    
    <!-- Chatbot de Preguntas Frecuentes -->
    <div id="chatbot-container" class="chatbot-container">
        <div class="chatbot-header">
            <div class="chatbot-header-content">
                <div class="chatbot-avatar">
                    <img src="chatbot/imagenes/chatbot-icon.png" alt="Asistente INJUV" class="chatbot-avatar-img">
                </div>
                <div class="chatbot-info">
                    <h3>Asistente INJUV</h3>
                    <span class="chatbot-status">游녤 Listo para ayudarte...</span>
                </div>
            </div>
            <button id="chatbot-close" class="chatbot-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="chatbot-messages" class="chatbot-messages"></div>
        <div class="chatbot-input-container">
            <input 
                type="text" 
                id="chatbot-input" 
                class="chatbot-input" 
                placeholder="Escribe tu pregunta aqu칤..."
                autocomplete="off"
            >
            <button id="chatbot-send" class="chatbot-send">
                <img src="chatbot/imagenes/Chatbot-enviar.png" alt="Enviar" class="send-icon-img">
            </button>
        </div>
    </div>
    
    <button id="chatbot-toggle" class="chatbot-toggle" aria-label="Abrir chatbot">
        <img src="chatbot/imagenes/chatbot-icon.png" alt="Chatbot" class="chatbot-toggle-icon">
        <span class="chatbot-badge">?</span>
    </button>
    
    <!-- Modal para mostrar contenido completo de noticia -->
    <div id="modalNoticia" class="news-modal" style="display: none;">
        <div class="news-modal-overlay" onclick="cerrarModalNoticia()"></div>
        <div class="news-modal-content">
            <div class="news-modal-header">
                <h2 id="modalNoticiaTitulo"></h2>
                <button class="news-modal-close" onclick="cerrarModalNoticia()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="news-modal-body">
                <div id="modalNoticiaImagen" class="news-modal-image"></div>
                <div id="modalNoticiaMeta" class="news-modal-meta"></div>
                <div id="modalNoticiaContenido" class="news-modal-text"></div>
            </div>
        </div>
    </div>

    <script src="chatbot/chatbot.js"></script>
    
    <script>
        // Funci칩n para ver el detalle completo de una noticia
        async function verDetalleNoticia(noticiaId) {
            try {
                const response = await fetch(`${API_BASE_URL}/noticias/${noticiaId}`);
                const data = await response.json();
                
                if (data.success && data.noticia) {
                    mostrarModalNoticia(data.noticia);
                } else {
                    alert('No se pudo cargar el contenido de la noticia');
                }
            } catch (error) {
                console.error('Error al cargar noticia:', error);
                alert('Error al cargar el contenido de la noticia');
            }
        }
        
        // Funci칩n para mostrar el modal con el contenido de la noticia
        function mostrarModalNoticia(noticia) {
            const modal = document.getElementById('modalNoticia');
            const titulo = document.getElementById('modalNoticiaTitulo');
            const imagen = document.getElementById('modalNoticiaImagen');
            const meta = document.getElementById('modalNoticiaMeta');
            const contenido = document.getElementById('modalNoticiaContenido');
            
            if (!modal) return;
            
            // Formatear fecha
            let fechaFormateada = '';
            if (noticia.fecha_publicacion) {
                const fechaObj = new Date(noticia.fecha_publicacion);
                if (!isNaN(fechaObj.getTime())) {
                    const diasSemana = ['dom', 'lun', 'mar', 'mi칠', 'jue', 'vie', 's치b'];
                    const meses = ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'];
                    const diaSemana = diasSemana[fechaObj.getDay()];
                    const dia = fechaObj.getDate();
                    const mes = meses[fechaObj.getMonth()];
                    const horas = fechaObj.getHours().toString().padStart(2, '0');
                    const minutos = fechaObj.getMinutes().toString().padStart(2, '0');
                    const ampm = horas >= 12 ? 'p. m.' : 'a. m.';
                    const horas12 = horas % 12 || 12;
                    fechaFormateada = `${diaSemana}, ${dia} ${mes}, ${horas12}:${minutos} ${ampm}`;
                }
            } else if (noticia.created_at) {
                const fechaObj = new Date(noticia.created_at);
                if (!isNaN(fechaObj.getTime())) {
                    const diasSemana = ['dom', 'lun', 'mar', 'mi칠', 'jue', 'vie', 's치b'];
                    const meses = ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'];
                    const diaSemana = diasSemana[fechaObj.getDay()];
                    const dia = fechaObj.getDate();
                    const mes = meses[fechaObj.getMonth()];
                    const horas = fechaObj.getHours().toString().padStart(2, '0');
                    const minutos = fechaObj.getMinutes().toString().padStart(2, '0');
                    const ampm = horas >= 12 ? 'p. m.' : 'a. m.';
                    const horas12 = horas % 12 || 12;
                    fechaFormateada = `${diaSemana}, ${dia} ${mes}, ${horas12}:${minutos} ${ampm}`;
                }
            }
            
            // Construir URL de imagen usando directamente lo que viene de la BD
            let imagenURL = '';
            const filename = noticia.imagen_filename || noticia.imagen_url || '';
            if (filename) {
                imagenURL = `${API_BASE_URL}/noticias/imagen/${filename}`;
            }
            
            // Llenar el modal
            titulo.textContent = noticia.titulo || 'Noticia';
            
            if (imagenURL) {
                imagen.innerHTML = `<img src="${imagenURL}" alt="${noticia.titulo}" class="news-modal-img">`;
            } else {
                imagen.innerHTML = '';
            }
            
            meta.innerHTML = `
                <div class="news-modal-author">
                    <span class="news-modal-author-label">Por:</span>
                    <span class="news-modal-author-name">${noticia.autor_nombre || 'INJUV'}</span>
                </div>
                ${fechaFormateada ? `
                <div class="news-modal-date">
                    <i class="fas fa-calendar-alt"></i>
                    <span>${fechaFormateada}</span>
                </div>
                ` : ''}
            `;
            
            // Formatear contenido con saltos de l칤nea
            const contenidoFormateado = (noticia.contenido || '').replace(/\n/g, '<br>');
            contenido.innerHTML = contenidoFormateado || '<p>No hay contenido disponible.</p>';
            
            // Mostrar modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevenir scroll del body
        }
        
        // Funci칩n para cerrar el modal
        function cerrarModalNoticia() {
            const modal = document.getElementById('modalNoticia');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = ''; // Restaurar scroll
            }
        }
        
        // Hacer funciones globales para que funcionen desde onclick
        window.verDetalleNoticia = verDetalleNoticia;
        window.cerrarModalNoticia = cerrarModalNoticia;
        
        // Cerrar modal con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cerrarModalNoticia();
            }
        });
        
        // Configurar enlace de "Preguntas frecuentes" para abrir el chatbot
        window.addEventListener('load', () => {
            const faqLink = document.getElementById('faq-link');
            
            if (faqLink) {
                faqLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Esperar a que el chatbot se haya inicializado
                    setTimeout(() => {
                        const chatbotToggle = document.getElementById('chatbot-toggle');
                        const chatbotContainer = document.getElementById('chatbot-container');
                        
                        if (chatbotContainer && chatbotToggle) {
                            // Si el chatbot est치 cerrado, abrirlo haciendo clic en el toggle
                            if (!chatbotContainer.classList.contains('chatbot-open')) {
                                chatbotToggle.click();
                            }
                            // Si ya est치 abierto, no hacer nada (solo mantenerlo abierto)
                        }
                    }, 300);
                });
            }
        });
    </script>
</body>
</html>
