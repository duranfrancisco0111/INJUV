<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voluntariados INJUV</title>

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  
  <!-- Typography -->
  <link rel="stylesheet" href="../typography.css">
  
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="styles.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['var(--font-body)','ui-sans-serif','system-ui'] },
          colors: { brand: { blue: '#2151ff' } },
          boxShadow: { card: '0 10px 16px -8px rgba(15, 23, 42, .08)' }
        }
      }
    }
  </script>
  <style>
    html { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    body { margin: 0; padding-top: 90px; }
    
    /* Estilos personalizados adicionales */
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .search-highlight {
      background-color: #fef3c7;
      padding: 2px 4px;
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

  <!-- Header -->
  <div id="header-container"></div>

  <!-- Contenido -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 mt-6" style="padding-top: 120px;">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

      <!-- Sidebar búsqueda -->
      <aside class="lg:col-span-4">
        <div class="bg-white rounded-2xl ring-1 ring-slate-200 p-4 sm:p-5 shadow-card">
          <h2 class="text-lg font-semibold">Buscar voluntariados</h2>

          <!-- Search -->
          <div class="mt-4">
            <label class="sr-only" for="q">Buscar</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="7"></circle>
                  <path d="M21 21l-4.3-4.3" stroke-linecap="round"></path>
                </svg>
              </span>
              <input id="searchInput" type="text" placeholder="Palabra clave, región o actividad" autocomplete="off"
                     class="w-full pl-10 pr-3 py-2.5 rounded-xl border border-slate-300 focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-100 text-[15px] placeholder:text-slate-400">
            </div>
          </div>

          <!-- Región -->
          <div class="mt-5">
            <label for="region" class="block text-sm font-medium text-slate-700">Región</label>
            <select id="regionFilter"
                    class="mt-2 w-full rounded-lg border border-slate-300 bg-white py-2.5 pl-3 pr-8 text-[15px] focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-100">
              <option value="">Todas</option>
              <option value="Región Metropolitana de Santiago">Región Metropolitana de Santiago</option>
              <option value="Valparaíso">Valparaíso</option>
              <option value="Bío Bío">Bío Bío</option>
              <option value="Araucanía">Araucanía</option>
              <option value="Los Lagos">Los Lagos</option>
              <option value="Atacama">Atacama</option>
              <option value="Coquimbo">Coquimbo</option>
              <option value="Maule">Maule</option>
              <option value="O'Higgins">O'Higgins</option>
              <option value="Arica y Parinacota">Arica y Parinacota</option>
            </select>
          </div>
          
          <!-- Área de Voluntariado -->
          <div class="mt-5">
            <label for="areaFilter" class="block text-sm font-medium text-slate-700">Tipo de Voluntariado</label>
            <select id="areaFilter"
                    class="mt-2 w-full rounded-lg border border-slate-300 bg-white py-2.5 pl-3 pr-8 text-[15px] focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-100">
              <option value="">Todas</option>
              <option value="Educación">Educación</option>
              <option value="Medio Ambiente">Medio Ambiente</option>
              <option value="Salud">Salud</option>
              <option value="Comunidad">Comunidad</option>
              <option value="Deporte">Deporte</option>
              <option value="Cultura">Cultura</option>
              <option value="Emergencia">Emergencia</option>
              <option value="Desarrollo Social">Desarrollo Social</option>
              <option value="Tecnología">Tecnología</option>
              <option value="Arte">Arte</option>
              <option value="Animales">Animales</option>
              <option value="Adultos Mayores">Adultos Mayores</option>
              <option value="Niños y Jóvenes">Niños y Jóvenes</option>
              <option value="Discapacidad">Discapacidad</option>
            </select>
          </div>

          <!-- Botón Aplicar Filtros -->
          <div class="mt-6">
            <button id="btnAplicarFiltros" 
                    class="w-full px-4 py-3 bg-brand-blue text-white rounded-xl font-semibold hover:bg-blue-700 transition shadow-md hover:shadow-lg">
              <i class="fas fa-filter mr-2"></i>
              Aplicar Filtros
            </button>
          </div>

          <div class="mt-5 rounded-xl bg-blue-50 text-slate-700 p-3 leading-5">
            ¿Primera vez? Regístrate y guarda tus postulaciones.
          </div>
        </div>
      </aside>

      <!-- Listado -->
      <section class="lg:col-span-8">
        <div class="flex items-end justify-between">
          <h2 class="text-2xl font-semibold">Voluntariados disponibles</h2>
          <span id="resultCount" class="text-sm text-slate-500">4 resultados</span>
        </div>

        <!-- Grid de tarjetas -->
        <div id="volunteerCards" class="mt-4 grid sm:grid-cols-1 md:grid-cols-2 gap-6">
          <div id="voluntariadosContainer" class="contents"></div>

          <!-- Cards estáticas (ocultas, se cargan dinámicamente desde el backend) -->
          <div id="cardsEstaticas" style="display: none;">
          <!-- Card 1 -->
          <article class="bg-white rounded-2xl ring-1 ring-slate-200 p-5 shadow-card card-hover fade-in" data-title="Reforestación urbana" data-region="Región Metropolitana" data-organization="Fundación Verde Urbano">
            <h3 class="text-lg font-semibold">Reforestación urbana</h3>
            <p class="text-slate-600 text-sm mt-1">
              Jornada de plantación y mantenimiento de áreas verdes en espacios públicos.
            </p>

            <div class="mt-3 inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-green-50 border border-green-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-[14px] w-[14px] text-green-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              <span class="text-xs font-medium text-green-800">Fundación Verde Urbano</span>
            </div>

            <ul class="mt-4 space-y-2 text-sm text-slate-600">
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22s7-4.5 7-11a7 7 0 10-14 0c0 6.5 7 11 7 11z"></path>
                  <circle cx="12" cy="11" r="2.5"></circle>
                </svg>
                Región Metropolitana
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                  <path d="M16 2v4M8 2v4M3 10h18"></path>
                </svg>
                05-10-2025
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="3"></circle>
                  <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                25 cupos
              </li>
            </ul>

            <div class="mt-5 flex items-center gap-3">
              <button class="px-4 py-2 rounded-xl bg-brand-blue text-white text-sm font-semibold shadow hover:bg-blue-700 transition" onclick="postularVoluntariado('Reforestación urbana')">Postular</button>
              <button class="px-4 py-2 rounded-xl border border-slate-300 text-sm font-semibold text-slate-700 bg-white hover:bg-slate-50 transition" onclick="verDetalles('Reforestación urbana')">Ver detalles</button>
            </div>
          </article>

          <!-- Card 2 -->
          <article class="bg-white rounded-2xl ring-1 ring-slate-200 p-5 shadow-card card-hover fade-in" data-title="Apoyo a comedor comunitario" data-region="Valparaíso" data-organization="Red Solidaria Valparaíso">
            <h3 class="text-lg font-semibold">Apoyo a comedor comunitario</h3>
            <p class="text-slate-600 text-sm mt-1">
              Turnos de preparación y servicio de alimentos en organización social.
            </p>

            <div class="mt-3 inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-orange-50 border border-orange-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-[14px] w-[14px] text-orange-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              <span class="text-xs font-medium text-orange-800">Red Solidaria Valparaíso</span>
            </div>

            <ul class="mt-4 space-y-2 text-sm text-slate-600">
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22s7-4.5 7-11a7 7 0 10-14 0c0 6.5 7 11 7 11z"></path>
                  <circle cx="12" cy="11" r="2.5"></circle>
                </svg>
                Valparaíso
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                  <path d="M16 2v4M8 2v4M3 10h18"></path>
                </svg>
                19-09-2025
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="3"></circle>
                  <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                12 cupos
              </li>
            </ul>

            <div class="mt-5 flex items-center gap-3">
              <button class="px-4 py-2 rounded-xl bg-brand-blue text-white text-sm font-semibold shadow hover:bg-blue-700 transition" onclick="postularVoluntariado('Apoyo a comedor comunitario')">Postular</button>
              <button class="px-4 py-2 rounded-xl border border-slate-300 text-sm font-semibold text-slate-700 bg-white hover:bg-slate-50 transition" onclick="verDetalles('Apoyo a comedor comunitario')">Ver detalles</button>
            </div>
          </article>

          <!-- Card 3 -->
          <article class="bg-white rounded-2xl ring-1 ring-slate-200 p-5 shadow-card card-hover fade-in" data-title="Limpieza de playas" data-region="Biobío" data-organization="ONG Océano Limpio">
            <h3 class="text-lg font-semibold">Limpieza de playas</h3>
            <p class="text-slate-600 text-sm mt-1">
              Operativo de retiro de residuos y educación ambiental con la comunidad costera.
            </p>

            <div class="mt-3 inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-blue-50 border border-blue-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-[14px] w-[14px] text-blue-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              <span class="text-xs font-medium text-blue-800">ONG Océano Limpio</span>
            </div>

            <ul class="mt-4 space-y-2 text-sm text-slate-600">
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22s7-4.5 7-11a7 7 0 10-14 0c0 6.5 7 11 7 11z"></path>
                  <circle cx="12" cy="11" r="2.5"></circle>
                </svg>
                Biobío
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                  <path d="M16 2v4M8 2v4M3 10h18"></path>
                </svg>
                28-09-2025
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="3"></circle>
                  <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                40 cupos
              </li>
            </ul>

            <div class="mt-5 flex items-center gap-3">
              <button class="px-4 py-2 rounded-xl bg-brand-blue text-white text-sm font-semibold shadow hover:bg-blue-700 transition" onclick="postularVoluntariado('Limpieza de playas')">Postular</button>
              <button class="px-4 py-2 rounded-xl border border-slate-300 text-sm font-semibold text-slate-700 bg-white hover:bg-slate-50 transition" onclick="verDetalles('Limpieza de playas')">Ver detalles</button>
            </div>
          </article>

          <!-- Card 4 (Tutorías digitales) -->
          <article class="bg-white rounded-2xl ring-1 ring-slate-200 p-5 shadow-card card-hover fade-in" data-title="Tutorías digitales" data-region="Araucanía" data-organization="Centro Digital Araucanía">
            <h3 class="text-lg font-semibold">Tutorías digitales</h3>
            <p class="text-slate-600 text-sm mt-1">
              Acompañamiento y alfabetización digital para adultos mayores.
            </p>

            <div class="mt-3 inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-purple-50 border border-purple-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-[14px] w-[14px] text-purple-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              <span class="text-xs font-medium text-purple-800">Centro Digital Araucanía</span>
            </div>

            <ul class="mt-4 space-y-2 text-sm text-slate-600">
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22s7-4.5 7-11a7 7 0 10-14 0c0 6.5 7 11 7 11z"></path>
                  <circle cx="12" cy="11" r="2.5"></circle>
                </svg>
                Araucanía
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                  <path d="M16 2v4M8 2v4M3 10h18"></path>
                </svg>
                15-10-2025
              </li>
              <li class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="3"></circle>
                  <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                18 cupos
              </li>
            </ul>

            <div class="mt-5 flex items-center gap-3">
              <button class="px-4 py-2 rounded-xl bg-brand-blue text-white text-sm font-semibold shadow hover:bg-blue-700 transition" onclick="postularVoluntariado('Tutorías digitales')">Postular</button>
              <button class="px-4 py-2 rounded-xl border border-slate-300 text-sm font-semibold text-slate-700 bg-white hover:bg-slate-50 transition" onclick="verDetalles('Tutorías digitales')">Ver detalles</button>
            </div>
          </article>
          </div>

        </div>
      </section>
    </div>

    <!-- Sección Repositorio -->
    <section id="repositorio" class="mt-12 mb-12">
      <div class="bg-white rounded-2xl ring-1 ring-slate-200 p-8 shadow-card">
        <div class="flex items-center gap-3 mb-6">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-brand-blue" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
          <h2 class="text-3xl font-bold text-slate-900">Repositorio</h2>
        </div>

        <p class="text-slate-600 text-lg mb-8 leading-relaxed">
          Accede a recursos, guías y materiales de apoyo para organizaciones y voluntarios.
          Encuentra herramientas útiles para planificar, ejecutar y evaluar tus proyectos de voluntariado.
        </p>

        <div class="grid sm:grid-cols-1 md:grid-cols-3 gap-6">
          <div class="p-6 rounded-xl border border-slate-200 hover:shadow-lg transition-shadow card-hover">
            <div class="h-12 w-12 rounded-xl bg-blue-100 flex items-center justify-center mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
              </svg>
            </div>
            <h3 class="text-lg font-semibold mb-2">Guías y Manuales</h3>
            <p class="text-sm text-slate-600 mb-4">Documentación completa para organizar actividades de voluntariado exitosas.</p>
            <a href="#" class="text-sm font-semibold text-brand-blue hover:text-blue-700" onclick="abrirRecurso('guias')">Ver recursos →</a>
          </div>

          <div class="p-6 rounded-xl border border-slate-200 hover:shadow-lg transition-shadow card-hover">
            <div class="h-12 w-12 rounded-xl bg-green-100 flex items-center justify-center mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </div>
            <h3 class="text-lg font-semibold mb-2">Plantillas y Formatos</h3>
            <p class="text-sm text-slate-600 mb-4">Descarga plantillas editables para reportes, inscripciones y evaluaciones.</p>
            <a href="#" class="text-sm font-semibold text-brand-blue hover:text-blue-700" onclick="abrirRecurso('plantillas')">Descargar →</a>
          </div>

          <div class="p-6 rounded-xl border border-slate-200 hover:shadow-lg transition-shadow card-hover">
            <div class="h-12 w-12 rounded-xl bg-orange-100 flex items-center justify-center mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polygon points="10 8 16 12 10 16 10 8"></polygon>
              </svg>
            </div>
            <h3 class="text-lg font-semibold mb-2">Videos Tutoriales</h3>
            <p class="text-sm text-slate-600 mb-4">Aprende paso a paso cómo gestionar y participar en voluntariados.</p>
            <a href="#" class="text-sm font-semibold text-brand-blue hover:text-blue-700" onclick="abrirRecurso('videos')">Ver videos →</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal para detalles -->
  <div id="modalDetalles" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex justify-between items-start mb-4">
          <h3 id="modalTitulo" class="text-2xl font-bold text-slate-900"></h3>
          <button onclick="cerrarModal()" class="text-slate-400 hover:text-slate-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div id="modalContenido" class="text-slate-600"></div>
        <div class="mt-6 flex gap-3">
          <button onclick="postularDesdeModal()" class="px-6 py-2 bg-brand-blue text-white rounded-xl font-semibold hover:bg-blue-700 transition">
            Postular ahora
          </button>
          <button onclick="cerrarModal()" class="px-6 py-2 border border-slate-300 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 transition">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmación de postulación -->
  <div id="modalPostulacion" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-md w-full">
      <div class="p-6 text-center">
        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-slate-900 mb-2">¡Postulación exitosa!</h3>
        <p id="mensajePostulacion" class="text-slate-600 mb-6"></p>
        <button onclick="cerrarModalPostulacion()" class="px-6 py-2 bg-brand-blue text-white rounded-xl font-semibold hover:bg-blue-700 transition">
          Entendido
        </button>
      </div>
    </div>
  </div>

  <script>
    // Datos de los voluntariados
    const voluntariados = {
      'Reforestación urbana': {
        titulo: 'Reforestación urbana',
        descripcion: 'Jornada de plantación y mantenimiento de áreas verdes en espacios públicos.',
        organizacion: 'Fundación Verde Urbano',
        region: 'Región Metropolitana',
        fecha: '05-10-2025',
        cupos: 25,
        detalles: `
          <h4 class="font-semibold text-lg mb-3">Descripción detallada</h4>
          <p class="mb-4">Únete a esta importante iniciativa de reforestación urbana que busca crear más espacios verdes en nuestra ciudad. Los voluntarios participarán en la plantación de árboles nativos y el mantenimiento de áreas verdes en parques y plazas públicas.</p>
          
          <h4 class="font-semibold text-lg mb-3">Actividades a realizar</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Preparación del terreno para plantación</li>
            <li>Plantación de árboles nativos</li>
            <li>Instalación de sistemas de riego</li>
            <li>Mantenimiento de áreas verdes existentes</li>
            <li>Educación ambiental a la comunidad</li>
          </ul>
          
          <h4 class="font-semibold text-lg mb-3">Requisitos</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Mayor de 18 años</li>
            <li>Disponibilidad los sábados de 9:00 a 13:00</li>
            <li>Ropa cómoda y zapatos cerrados</li>
            <li>Interés en temas ambientales</li>
          </ul>
          
          <h4 class="font-semibold text-lg mb-3">Beneficios</h4>
          <ul class="list-disc list-inside space-y-1">
            <li>Certificado de participación</li>
            <li>Almuerzo incluido</li>
            <li>Kit de herramientas</li>
            <li>Experiencia en conservación ambiental</li>
          </ul>
        `
      },
      'Apoyo a comedor comunitario': {
        titulo: 'Apoyo a comedor comunitario',
        descripcion: 'Turnos de preparación y servicio de alimentos en organización social.',
        organizacion: 'Red Solidaria Valparaíso',
        region: 'Valparaíso',
        fecha: '19-09-2025',
        cupos: 12,
        detalles: `
          <h4 class="font-semibold text-lg mb-3">Descripción detallada</h4>
          <p class="mb-4">Colabora con nuestro comedor comunitario que atiende a familias en situación de vulnerabilidad. Los voluntarios ayudarán en la preparación y servicio de comidas nutritivas para la comunidad.</p>
          
          <h4 class="font-semibold text-lg mb-3">Actividades a realizar</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Preparación de ingredientes</li>
            <li>Cocción de alimentos</li>
            <li>Servicio de comidas</li>
            <li>Limpieza de utensilios</li>
            <li>Atención a beneficiarios</li>
          </ul>
          
          <h4 class="font-semibold text-lg mb-3">Requisitos</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Mayor de 16 años</li>
            <li>Disponibilidad en horarios de almuerzo</li>
            <li>Certificado de manipulación de alimentos (opcional)</li>
            <li>Actitud solidaria y empática</li>
          </ul>
        `
      },
      'Limpieza de playas': {
        titulo: 'Limpieza de playas',
        descripcion: 'Operativo de retiro de residuos y educación ambiental con la comunidad costera.',
        organizacion: 'ONG Océano Limpio',
        region: 'Biobío',
        fecha: '28-09-2025',
        cupos: 40,
        detalles: `
          <h4 class="font-semibold text-lg mb-3">Descripción detallada</h4>
          <p class="mb-4">Participa en esta importante iniciativa de limpieza de playas que busca proteger nuestros océanos y educar a la comunidad sobre la importancia de mantener las costas limpias.</p>
          
          <h4 class="font-semibold text-lg mb-3">Actividades a realizar</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Recolección de residuos en la playa</li>
            <li>Clasificación de materiales reciclables</li>
            <li>Educación ambiental a visitantes</li>
            <li>Registro de datos para investigación</li>
            <li>Actividades recreativas con la comunidad</li>
          </ul>
          
          <h4 class="font-semibold text-lg mb-3">Requisitos</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Mayor de 14 años (con autorización de padres)</li>
            <li>Disponibilidad domingos de 8:00 a 12:00</li>
            <li>Ropa cómoda y protector solar</li>
            <li>Interés en conservación marina</li>
          </ul>
        `
      },
      'Tutorías digitales': {
        titulo: 'Tutorías digitales',
        descripcion: 'Acompañamiento y alfabetización digital para adultos mayores.',
        organizacion: 'Centro Digital Araucanía',
        region: 'Araucanía',
        fecha: '15-10-2025',
        cupos: 18,
        detalles: `
          <h4 class="font-semibold text-lg mb-3">Descripción detallada</h4>
          <p class="mb-4">Ayuda a adultos mayores a familiarizarse con la tecnología digital. Este programa busca reducir la brecha digital y mejorar la calidad de vida de nuestros adultos mayores.</p>
          
          <h4 class="font-semibold text-lg mb-3">Actividades a realizar</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Enseñanza de uso básico de smartphones</li>
            <li>Navegación en internet</li>
            <li>Uso de redes sociales</li>
            <li>Compras online seguras</li>
            <li>Uso de aplicaciones bancarias</li>
          </ul>
          
          <h4 class="font-semibold text-lg mb-3">Requisitos</h4>
          <ul class="list-disc list-inside mb-4 space-y-1">
            <li>Mayor de 18 años</li>
            <li>Conocimientos básicos de tecnología</li>
            <li>Paciencia y empatía</li>
            <li>Disponibilidad en horarios de tarde</li>
          </ul>
        `
      }
    };

    let voluntariadoActual = '';

    // Funciones principales
    function filtrarVoluntariados() {
      const searchInput = document.getElementById('searchInput');
      const regionFilter = document.getElementById('regionFilter');
      const areaFilter = document.getElementById('areaFilter');
      
      if (!searchInput || !regionFilter) {
        console.error('Elementos de búsqueda no encontrados');
        return;
      }
      
      const busqueda = searchInput.value.toLowerCase().trim();
      const region = regionFilter.value;
      const area = areaFilter ? areaFilter.value : '';
      const cards = document.querySelectorAll('#voluntariadosContainer article');
      let contador = 0;

      if (cards.length === 0) {
        console.log('No hay tarjetas para filtrar');
        return;
      }

      cards.forEach(card => {
        const titulo = card.dataset.title ? card.dataset.title.toLowerCase() : '';
        const regionCard = card.dataset.region || '';
        const areaCard = card.dataset.area || '';
        const organizacion = card.dataset.organization ? card.dataset.organization.toLowerCase() : '';
        
        // Buscar también en la descripción (texto visible de la tarjeta)
        const descripcionElement = card.querySelector('p.text-slate-600');
        const descripcion = descripcionElement ? descripcionElement.textContent.toLowerCase() : '';
        
        // Verificar coincidencia de búsqueda
        const coincideBusqueda = busqueda === '' || 
          titulo.includes(busqueda) || 
          regionCard.toLowerCase().includes(busqueda) || 
          organizacion.includes(busqueda) ||
          descripcion.includes(busqueda);
        
        // Verificar coincidencia de región
        const coincideRegion = region === '' || regionCard === region;
        
        // Verificar coincidencia de área
        const coincideArea = area === '' || areaCard === area;
        
        // Mostrar u ocultar según los filtros
        if (coincideBusqueda && coincideRegion && coincideArea) {
          card.style.display = 'block';
          card.classList.add('fade-in');
          contador++;
        } else {
          card.style.display = 'none';
        }
      });

      // Actualizar contador de resultados
      const resultCount = document.getElementById('resultCount');
      if (resultCount) {
        resultCount.textContent = `${contador} resultado${contador !== 1 ? 's' : ''}`;
      }
    }

    // Variable global para almacenar oportunidades cargadas
    let oportunidadesCargadas = [];
    let oportunidadSeleccionada = null;
    let postulacionesUsuario = [];
    const API_BASE_URL = 'http://localhost:5000/api';

    // Función para cargar las postulaciones del usuario
    async function cargarPostulacionesUsuario() {
      const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
      if (!userId) {
        postulacionesUsuario = [];
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/usuarios/${userId}/postulaciones`);
        if (!response.ok) {
          throw new Error(`Error del servidor: ${response.status}`);
        }
        const data = await response.json();
        if (data.success && data.postulaciones) {
          postulacionesUsuario = data.postulaciones.map(post => post.oportunidad_id);
        }
      } catch (error) {
        console.error('Error al cargar postulaciones:', error);
        postulacionesUsuario = [];
        // No mostrar error al usuario si falla cargar postulaciones, solo continuar
      }
    }

    // Función para verificar si el usuario ya postuló a una oportunidad
    function yaPostulo(oportunidadId) {
      return postulacionesUsuario.includes(oportunidadId);
    }

    // Función para mostrar mensajes de error
    function mostrarMensajeError(mensaje) {
      const container = document.getElementById('voluntariadosContainer');
      if (container) {
        container.innerHTML = `
          <div class="col-span-2 bg-red-50 border border-red-200 rounded-xl p-6 text-center">
            <i class="fas fa-exclamation-triangle text-red-600 text-2xl mb-3"></i>
            <p class="text-red-800 font-semibold mb-2">Error de conexión</p>
            <p class="text-red-600 text-sm">${mensaje}</p>
          </div>
        `;
      }
      const resultCount = document.getElementById('resultCount');
      if (resultCount) {
        resultCount.textContent = '0 resultados';
      }
    }

    // Cargar oportunidades desde el backend
    async function cargarOportunidades() {
      try {
        // Cargar postulaciones del usuario primero
        await cargarPostulacionesUsuario();
        
        // Obtener valores de los filtros de la UI (no solo de la URL)
        const regionFilter = document.getElementById('regionFilter');
        const areaFilter = document.getElementById('areaFilter');
        
        // Obtener parámetros de la URL (para cuando se carga desde un enlace)
        const urlParams = new URLSearchParams(window.location.search);
        let area = urlParams.get('area');
        let region = urlParams.get('region');
        
        // Si no hay parámetros en la URL, usar los valores de los filtros de la UI
        if (!region && regionFilter && regionFilter.value) {
          region = regionFilter.value;
        }
        if (!area && areaFilter && areaFilter.value) {
          area = areaFilter.value;
        }
        
        // Construir URL con filtros
        let url = `${API_BASE_URL}/oportunidades?estado=activa`;
        if (area) {
          url += `&area=${encodeURIComponent(area)}`;
        }
        if (region) {
          url += `&region=${encodeURIComponent(region)}`;
        }
        
        console.log('Cargando oportunidades con filtros:', { region, area, url });
        console.log('Valores de los filtros:', {
          regionFilterValue: regionFilter ? regionFilter.value : 'N/A',
          areaFilterValue: areaFilter ? areaFilter.value : 'N/A',
          regionFromURL: region,
          areaFromURL: area,
          regionFinal: region,
          areaFinal: area
        });
        
        // Validar que los filtros se estén aplicando
        if (region && regionFilter && regionFilter.value !== region) {
          console.warn('⚠️ ADVERTENCIA: El valor de región del filtro no coincide:', {
            filterValue: regionFilter.value,
            usedValue: region
          });
        }
        if (area && areaFilter && areaFilter.value !== area) {
          console.warn('⚠️ ADVERTENCIA: El valor de área del filtro no coincide:', {
            filterValue: areaFilter.value,
            usedValue: area
          });
        }
        
        // Actualizar los filtros en la UI si vienen de la URL
        if (urlParams.get('region') && regionFilter) {
          regionFilter.value = urlParams.get('region');
        }
        if (urlParams.get('area') && areaFilter) {
          areaFilter.value = urlParams.get('area');
        }
        
        console.log('Solicitando oportunidades desde:', url);
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`Error del servidor: ${response.status}`);
        }
        
        const data = await response.json();
        
        console.log('Respuesta del servidor:', data);
        console.log('Oportunidades recibidas:', data.oportunidades?.length || 0);
        
        if (data.success) {
          oportunidadesCargadas = data.oportunidades;
          console.log('Mostrando oportunidades:', oportunidadesCargadas.length);
          mostrarOportunidades(data.oportunidades);
        } else {
          console.error('Error al cargar oportunidades:', data.error);
          mostrarMensajeError('No se pudieron cargar las oportunidades. Por favor, intenta nuevamente.');
        }
      } catch (error) {
        console.error('Error de conexión:', error);
        if (error.message.includes('Failed to fetch') || error.message.includes('ERR_CONNECTION_REFUSED')) {
          mostrarMensajeError('No se pudo conectar con el servidor. Por favor, verifica que el backend esté corriendo.');
        } else {
          mostrarMensajeError('Error al cargar las oportunidades. Por favor, intenta nuevamente.');
        }
      }
    }

    // Mostrar oportunidades en el DOM
    function mostrarOportunidades(oportunidades) {
      const container = document.getElementById('voluntariadosContainer');
      const cardsEstaticas = document.getElementById('cardsEstaticas');
      
      if (!container) return;

      // Ocultar cards estáticas
      if (cardsEstaticas) {
        cardsEstaticas.style.display = 'none';
      }

      container.innerHTML = '';

      if (oportunidades.length === 0) {
        // Verificar si hay filtros aplicados
        const regionFilter = document.getElementById('regionFilter');
        const areaFilter = document.getElementById('areaFilter');
        const hasFilters = (regionFilter && regionFilter.value) || (areaFilter && areaFilter.value);
        
        if (hasFilters) {
          const regionText = regionFilter && regionFilter.value ? ` en ${regionFilter.value}` : '';
          const areaText = areaFilter && areaFilter.value ? ` de tipo "${areaFilter.value}"` : '';
          container.innerHTML = `
            <div class="col-span-2 bg-yellow-50 border border-yellow-200 rounded-xl p-6 text-center">
              <i class="fas fa-info-circle text-yellow-600 text-2xl mb-3"></i>
              <p class="text-yellow-800 font-semibold mb-2">No se encontraron resultados</p>
              <p class="text-yellow-600 text-sm">No hay oportunidades disponibles${regionText}${areaText}.</p>
              <p class="text-yellow-600 text-xs mt-2">Intenta cambiar los filtros o limpiarlos para ver todas las oportunidades.</p>
            </div>
          `;
        } else {
          container.innerHTML = '<p class="text-slate-600 text-center py-8 col-span-2">No hay oportunidades disponibles en este momento.</p>';
        }
        const resultCount = document.getElementById('resultCount');
        if (resultCount) {
          resultCount.textContent = '0 resultados';
        }
        return;
      }

      oportunidades.forEach(op => {
        const card = crearCardOportunidad(op);
        container.appendChild(card);
      });

      // Actualizar contador
      document.getElementById('resultCount').textContent = `${oportunidades.length} resultado${oportunidades.length !== 1 ? 's' : ''}`;
    }

    // Crear card HTML para una oportunidad
    function crearCardOportunidad(op) {
      const article = document.createElement('article');
      article.className = 'bg-white rounded-2xl ring-1 ring-slate-200 p-5 shadow-card card-hover fade-in';
      article.setAttribute('data-title', op.titulo);
      article.setAttribute('data-region', op.region_opor || op.organizacion_region || '');
      article.setAttribute('data-organization', op.organizacion_nombre || '');
      article.setAttribute('data-area', op.area_voluntariado || op.tipo_de_voluntariado || '');

      const fechaLimite = op.fecha_limite_postulacion ? 
        new Date(op.fecha_limite_postulacion).toLocaleDateString('es-CL') : 
        'Sin fecha límite';

      article.innerHTML = `
        <h3 class="text-lg font-semibold">${op.titulo}</h3>
        <p class="text-slate-600 text-sm mt-1">${op.descripcion.substring(0, 100)}${op.descripcion.length > 100 ? '...' : ''}</p>

        <div class="mt-3 flex flex-wrap gap-2">
          <div class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-orange-50 border border-orange-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-[14px] w-[14px] text-orange-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="text-xs font-medium text-orange-800">${op.organizacion_nombre || 'Organización'}</span>
          </div>
          ${(op.area_voluntariado || op.tipo_de_voluntariado) ? `
          <div class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-blue-50 border border-blue-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-[14px] w-[14px] text-blue-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5"></path>
              <path d="M2 12l10 5 10-5"></path>
            </svg>
            <span class="text-xs font-medium text-blue-800">${op.tipo_de_voluntariado || op.area_voluntariado || ''}</span>
          </div>
          ` : ''}
        </div>

        <ul class="mt-4 space-y-2 text-sm text-slate-600">
          <li class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s7-4.5 7-11a7 7 0 10-14 0c0 6.5 7 11 7 11z"></path>
              <circle cx="12" cy="11" r="2.5"></circle>
            </svg>
            ${op.region_opor || op.organizacion_region || 'N/A'} - ${op.comuna_opor || op.organizacion_comuna || 'N/A'}
          </li>
          <li class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2"></rect>
              <path d="M16 2v4M8 2v4M3 10h18"></path>
            </svg>
            Postulación hasta: ${fechaLimite}
          </li>
          ${(op.fecha_inicio_voluntariado || op.fecha_fin_voluntariado) ? `
          <li class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-green-600 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"></path>
            </svg>
            <span class="text-green-700 font-medium">
              ${op.fecha_inicio_voluntariado ? new Date(op.fecha_inicio_voluntariado).toLocaleDateString('es-CL') : 'TBD'} - ${op.fecha_fin_voluntariado ? new Date(op.fecha_fin_voluntariado).toLocaleDateString('es-CL') : 'TBD'}
            </span>
          </li>
          ` : ''}
          ${(op.horas_voluntariado !== null && op.horas_voluntariado !== undefined && op.horas_voluntariado !== '') ? `
          <li class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-purple-600 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 8v4l3 3"></path>
              <circle cx="12" cy="12" r="10"></circle>
            </svg>
            <span class="text-purple-700 font-medium">${op.horas_voluntariado} horas</span>
          </li>
          ` : ''}
          <li class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px] text-slate-500 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="3"></circle>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            ${op.cupo_maximo || 'N/A'} cupos
          </li>
        </ul>

        <div class="mt-5 flex items-center gap-3">
          ${yaPostulo(op.id) 
            ? `<button disabled class="px-4 py-2 rounded-xl bg-gray-400 text-white text-sm font-semibold shadow cursor-not-allowed opacity-60">
                ✓ Ya postulaste
              </button>`
            : `<button onclick="postularVoluntariado(${op.id})" class="px-4 py-2 rounded-xl bg-brand-blue text-white text-sm font-semibold shadow hover:bg-blue-700 transition">
                Postular
              </button>`
          }
          <button onclick="verDetalles(${op.id})" class="px-4 py-2 rounded-xl border border-slate-300 text-sm font-semibold text-slate-700 bg-white hover:bg-slate-50 transition">
            Ver detalles
          </button>
        </div>
      `;

      return article;
    }

    async function postularVoluntariado(oportunidadId) {
      // Verificar si el usuario está logueado
      const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
      
      if (!userId) {
        alert('Debes iniciar sesión para postular a una oportunidad');
        if (typeof window.redirectTo === 'function') {
          window.redirectTo('../inicio de sesion/login.html');
        } else {
          window.location.href = '../inicio de sesion/login.html';
        }
        return;
      }

      // Verificar si ya postuló
      if (yaPostulo(oportunidadId)) {
        alert('Ya has postulado a esta oportunidad');
        return;
      }

      // Buscar la oportunidad
      const oportunidad = oportunidadesCargadas.find(op => op.id === oportunidadId);
      if (!oportunidad) {
        alert('Oportunidad no encontrada');
        return;
      }

      oportunidadSeleccionada = oportunidad;

      // Mostrar modal de confirmación
      document.getElementById('modalPostulacion').classList.remove('hidden');
      document.getElementById('mensajePostulacion').textContent = 
        `¿Estás seguro de que deseas postular a "${oportunidad.titulo}"?`;

      // Agregar botones de confirmación
      const modalContent = document.querySelector('#modalPostulacion .p-6');
      const botonesContainer = modalContent.querySelector('.flex.gap-3') || modalContent.appendChild(document.createElement('div'));
      botonesContainer.className = 'flex gap-3 mt-4';
      botonesContainer.innerHTML = `
        <button onclick="confirmarPostulacion(${oportunidadId}, ${userId})" class="px-6 py-2 bg-brand-blue text-white rounded-xl font-semibold hover:bg-blue-700 transition">
          Confirmar postulación
        </button>
        <button onclick="cerrarModalPostulacion()" class="px-6 py-2 border border-slate-300 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 transition">
          Cancelar
        </button>
      `;
    }

    async function confirmarPostulacion(oportunidadId, userId) {
      try {
        // Validar que los IDs sean válidos
        if (!userId || !oportunidadId) {
          alert('Error: No se pudo obtener la información necesaria para postular');
          return;
        }
        
        const usuarioIdInt = parseInt(userId);
        const oportunidadIdInt = parseInt(oportunidadId);
        
        if (isNaN(usuarioIdInt) || isNaN(oportunidadIdInt)) {
          alert('Error: Los datos de postulación no son válidos');
          return;
        }
        
        console.log('Enviando postulación:', { usuario_id: usuarioIdInt, oportunidad_id: oportunidadIdInt });
        
        const response = await fetch(`${API_BASE_URL}/postulaciones`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            usuario_id: usuarioIdInt,
            oportunidad_id: oportunidadIdInt
          })
        });

        const data = await response.json();
        console.log('Respuesta del servidor:', data);

        if (data.success) {
          // Agregar la postulación a la lista local
          postulacionesUsuario.push(oportunidadId);
          
          // Recargar las oportunidades para actualizar los botones
          await cargarOportunidades();
          
          document.getElementById('mensajePostulacion').textContent = 
            `¡Postulación exitosa! Te has postulado a "${oportunidadSeleccionada.titulo}". Recibirás un correo de confirmación pronto.`;
          
          // Actualizar botones
          const botonesContainer = document.querySelector('#modalPostulacion .flex.gap-3');
          if (botonesContainer) {
            botonesContainer.innerHTML = `
              <button onclick="cerrarModalPostulacion()" class="px-6 py-2 bg-brand-blue text-white rounded-xl font-semibold hover:bg-blue-700 transition">
                Entendido
              </button>
            `;
          }
        } else {
          // Mostrar el mensaje de error del backend de forma más clara
          const errorMsg = data.error || 'Error al postular. Por favor, intenta nuevamente.';
          console.error('Error en postulación:', errorMsg);
          
          // Actualizar el mensaje en el modal en lugar de solo mostrar un alert
          const mensajeEl = document.getElementById('mensajePostulacion');
          if (mensajeEl) {
            mensajeEl.textContent = `❌ ${errorMsg}`;
            mensajeEl.style.color = '#dc2626'; // Rojo para errores
          }
          
          // Actualizar botones para permitir cerrar o intentar de nuevo
          const botonesContainer = document.querySelector('#modalPostulacion .flex.gap-3');
          if (botonesContainer) {
            botonesContainer.innerHTML = `
              <button onclick="cerrarModalPostulacion()" class="px-6 py-2 bg-brand-blue text-white rounded-xl font-semibold hover:bg-blue-700 transition">
                Entendido
              </button>
            `;
          }
          
          // También mostrar alert para asegurar que el usuario vea el mensaje
          alert(errorMsg);
        }
      } catch (error) {
        console.error('Error al postular:', error);
        alert('Error de conexión con el servidor. Verifica que el backend esté corriendo.');
        cerrarModalPostulacion();
      }
    }

    async function verDetalles(oportunidadId) {
      try {
        const response = await fetch(`${API_BASE_URL}/oportunidades/${oportunidadId}`);
        const data = await response.json();

        if (data.success) {
          const op = data.oportunidad;
          oportunidadSeleccionada = op;
          
          document.getElementById('modalTitulo').textContent = op.titulo;
          document.getElementById('modalContenido').innerHTML = `
            <div class="space-y-4">
              <div>
                <h4 class="font-semibold text-slate-900 mb-2">Descripción</h4>
                <p class="text-slate-600">${op.descripcion}</p>
              </div>
              <div>
                <h4 class="font-semibold text-slate-900 mb-2">Organización</h4>
                <p class="text-slate-600">${op.organizacion_nombre}</p>
              </div>
              <div>
                <h4 class="font-semibold text-slate-900 mb-2">Ubicación</h4>
                <p class="text-slate-600">${op.organizacion_region} - ${op.organizacion_comuna}</p>
              </div>
              <div>
                <h4 class="font-semibold text-slate-900 mb-2">Cupos disponibles</h4>
                <p class="text-slate-600">${op.cupo_maximo || 'No especificado'}</p>
              </div>
              ${op.horas_voluntariado !== null && op.horas_voluntariado !== undefined && op.horas_voluntariado !== '' ? `
              <div>
                <h4 class="font-semibold text-slate-900 mb-2">Horas del voluntariado</h4>
                <p class="text-slate-600">${op.horas_voluntariado} horas</p>
              </div>
              ` : ''}
              ${(op.fecha_inicio_voluntariado || op.fecha_fin_voluntariado) ? `
              <div>
                <h4 class="font-semibold text-slate-900 mb-2">Fechas del voluntariado</h4>
                <p class="text-slate-600">
                  ${op.fecha_inicio_voluntariado ? new Date(op.fecha_inicio_voluntariado).toLocaleDateString('es-CL') : 'TBD'}
                  -
                  ${op.fecha_fin_voluntariado ? new Date(op.fecha_fin_voluntariado).toLocaleDateString('es-CL') : 'TBD'}
                </p>
              </div>
              ` : ''}
              ${op.fecha_limite_postulacion ? `
              <div>
                <h4 class="font-semibold text-slate-900 mb-2">Fecha límite de postulación</h4>
                <p class="text-slate-600">${new Date(op.fecha_limite_postulacion).toLocaleDateString('es-CL')}</p>
              </div>
              ` : ''}
            </div>
          `;
          document.getElementById('modalDetalles').classList.remove('hidden');
        } else {
          alert('Error al cargar los detalles de la oportunidad');
        }
      } catch (error) {
        console.error('Error al cargar detalles:', error);
        alert('Error de conexión con el servidor');
      }
    }

    function postularDesdeModal() {
      if (oportunidadSeleccionada) {
        const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
        if (userId) {
          confirmarPostulacion(oportunidadSeleccionada.id, userId);
          cerrarModal();
        } else {
          alert('Debes iniciar sesión para postular');
          if (typeof window.redirectTo === 'function') {
            window.redirectTo('../inicio de sesion/login.html');
          } else {
            window.location.href = '../inicio de sesion/login.html';
          }
        }
      }
    }

    // Función verDetalles ya está actualizada arriba con async/await

    function cerrarModal() {
      document.getElementById('modalDetalles').classList.add('hidden');
    }

    function cerrarModalPostulacion() {
      document.getElementById('modalPostulacion').classList.add('hidden');
    }

    function abrirRecurso(tipo) {
      const recursos = {
        'guias': 'https://www.injuv.gob.cl/recursos/guias',
        'plantillas': 'https://www.injuv.gob.cl/recursos/plantillas',
        'videos': 'https://www.injuv.gob.cl/recursos/videos'
      };
      
      if (recursos[tipo]) {
        window.open(recursos[tipo], '_blank');
      } else {
        alert('Recurso en desarrollo. Próximamente disponible.');
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar oportunidades desde el backend
      cargarOportunidades();
      
      // Búsqueda en tiempo real (filtra en el cliente)
      document.getElementById('searchInput').addEventListener('input', filtrarVoluntariados);
      
      // Botón para aplicar filtros
      const btnAplicarFiltros = document.getElementById('btnAplicarFiltros');
      if (btnAplicarFiltros) {
        btnAplicarFiltros.addEventListener('click', function() {
          cargarOportunidades();
        });
      }
      
      // Si hay parámetros en la URL, aplicarlos automáticamente
      const urlParams = new URLSearchParams(window.location.search);
      const area = urlParams.get('area');
      const region = urlParams.get('region');
      
      const areaFilter = document.getElementById('areaFilter');
      if (area && areaFilter) {
        areaFilter.value = area;
      }
      
      const regionFilter = document.getElementById('regionFilter');
      if (region && regionFilter) {
        regionFilter.value = region;
      }
      
      // Cerrar modales al hacer clic fuera
      document.getElementById('modalDetalles').addEventListener('click', function(e) {
        if (e.target === this) {
          cerrarModal();
        }
      });
      
      document.getElementById('modalPostulacion').addEventListener('click', function(e) {
        if (e.target === this) {
          cerrarModalPostulacion();
        }
      });

      // Smooth scroll para enlaces internos
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });

      // Animación de entrada para las tarjetas
      const cards = document.querySelectorAll('#volunteerCards article');
      cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
      });
    });

    // Efecto de resaltado en búsqueda
    function resaltarTexto(texto, busqueda) {
      if (!busqueda) return texto;
      const regex = new RegExp(`(${busqueda})`, 'gi');
      return texto.replace(regex, '<span class="search-highlight">$1</span>');
    }


    // Detectar scroll para agregar efecto de sombra al header
    window.addEventListener('scroll', () => {
      const header = document.getElementById('header');
      if (header) {
        if(window.scrollY > 20){
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      }
    });
  </script>
  <script>
    // Definir funciones globales antes de cargar el header
    window.toggleProfileMenu = function(event) {
      event.preventDefault();
      event.stopPropagation();
      const profileDropdown = document.getElementById('profileDropdown');
      const profileButton = document.getElementById('profileButton');
      if (!profileDropdown || !profileButton) return;
      const isActive = profileDropdown.classList.contains('active');
      document.querySelectorAll('.profile-dropdown.active').forEach(dropdown => {
        if (dropdown !== profileDropdown) dropdown.classList.remove('active');
      });
      if (isActive) {
        profileDropdown.classList.remove('active');
        profileButton.setAttribute('aria-expanded', 'false');
      } else {
        profileDropdown.classList.add('active');
        profileButton.setAttribute('aria-expanded', 'true');
      }
    };
    
    window.goToProfile = function(event) {
      event.preventDefault();
      event.stopPropagation();
      const profileDropdown = document.getElementById('profileDropdown');
      if (profileDropdown) profileDropdown.classList.remove('active');
      if (typeof window.redirectTo === 'function') {
        window.redirectTo('../Roles/Perfil_usuario/index.html');
      } else {
        window.location.href = '../Roles/Perfil_usuario/index.html';
      }
    };
    
    window.handleLogout = function(event) {
      event.preventDefault();
      event.stopPropagation();
      if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userId');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userNombre');
        localStorage.removeItem('userApellido');
        localStorage.removeItem('userRol');
        localStorage.removeItem('userRole'); // Mantener por compatibilidad
        sessionStorage.removeItem('isLoggedIn');
        sessionStorage.removeItem('userId');
        sessionStorage.removeItem('userEmail');
        sessionStorage.removeItem('userRol');
        sessionStorage.removeItem('userRole'); // Mantener por compatibilidad
        if (typeof window.redirectTo === 'function') {
          window.redirectTo('../inicio de sesion/login.html');
        } else {
          window.location.href = '../inicio de sesion/login.html';
        }
      }
    };
    
    fetch('../header.html')
      .then(response => response.text())
      .then(data => {
        // Extraer scripts y estilos del header
        const parser = new DOMParser();
        const doc = parser.parseFromString(data, 'text/html');
        const headerContent = doc.querySelector('header');
        const styles = doc.querySelector('style');
        const scripts = doc.querySelectorAll('script');
        
        // Insertar estilos si existen
        if (styles) {
          const styleElement = document.createElement('style');
          styleElement.textContent = styles.textContent;
          document.head.appendChild(styleElement);
        }
        
        // Insertar el header
        const container = document.getElementById('header-container');
        if (container) {
          if (headerContent) {
            container.innerHTML = headerContent.outerHTML;
          } else {
            container.innerHTML = data;
          }
        }
        
        // Ejecutar los scripts del header manualmente
        scripts.forEach(oldScript => {
          const newScript = document.createElement('script');
          if (oldScript.src) {
            newScript.src = oldScript.src;
          } else {
            newScript.textContent = oldScript.textContent;
          }
          document.body.appendChild(newScript);
        });
        
        // Ejecutar script de autenticación inmediatamente después de insertar el header
        setTimeout(() => {
          // Verificar estado de login y actualizar header
          const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' || sessionStorage.getItem('isLoggedIn') === 'true';
          const loginLink = document.getElementById('login-link');
          const userProfileMenu = document.getElementById('userProfileMenu');
          const profileUserName = document.getElementById('profileUserName');
          const profileUserEmail = document.getElementById('profileUserEmail');
          
          if (isLoggedIn) {
            if (loginLink) {
              loginLink.style.display = 'none';
              loginLink.style.visibility = 'hidden';
            }
            if (userProfileMenu) {
              userProfileMenu.style.display = 'block';
              userProfileMenu.classList.add('active');
              
              // Actualizar información del usuario
              if (profileUserName) {
                const nombre = localStorage.getItem('userNombre') || '';
                const apellido = localStorage.getItem('userApellido') || '';
                profileUserName.textContent = `${nombre} ${apellido}`.trim() || 'Usuario';
              }
              if (profileUserEmail) {
                profileUserEmail.textContent = localStorage.getItem('userEmail') || sessionStorage.getItem('userEmail') || '';
              }
            }
          } else {
            if (loginLink) {
              loginLink.style.display = 'inline-flex';
              loginLink.style.visibility = 'visible';
            }
            if (userProfileMenu) {
              userProfileMenu.style.display = 'none';
              userProfileMenu.classList.remove('active');
            }
          }
          
          // Ejecutar funciones del header si existen
          if (typeof window.initHeaderAuth === 'function') {
            window.initHeaderAuth();
          }
          if (typeof window.updateHeaderAuth === 'function') {
            window.updateHeaderAuth();
          }
          
          // Configurar el menú de perfil después de un pequeño delay
          setTimeout(() => {
            if (typeof window.setupProfileMenu === 'function') {
              window.setupProfileMenu();
            }
          }, 100);
        }, 300);

        setTimeout(() => {
          const logo = document.getElementById('logo-link');
          if (logo) logo.href = '../index.html';

          const howWorks = document.getElementById('how-it-works-link');
          if (howWorks) howWorks.href = '../index.html#how-it-works';

          const experiencias = document.getElementById('experiencias-link');
          if (experiencias) experiencias.href = '../index.html#experiencias-voluntariado';

          const noticias = document.getElementById('news-link');
          if (noticias) {
            noticias.href = '../index.html#news';
            noticias.onclick = function(e) {
              if (window.goToNoticias) {
                window.goToNoticias(e);
              } else {
                e.preventDefault();
                if (typeof window.redirectTo === 'function') {
                  window.redirectTo('../index.html#news');
                } else {
                  window.location.href = '../index.html#news';
                }
              }
              return false;
            };
          }

          const login = document.getElementById('login-link');
          if (login) login.href = '../inicio de sesion/login.html';
          
          // Inicializar autenticación del header después de un pequeño delay
          setTimeout(() => {
            if (typeof window.initHeaderAuth === 'function') {
              window.initHeaderAuth();
            }
          }, 200);
        }, 100);
      })
      .catch(error => console.error('Error al cargar header:', error));
  </script>
  <script src="../script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>